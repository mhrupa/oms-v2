<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<script type="text/javascript">
	$(document).ready(function() {
		$("#statusMsg").html("");
		
		initBranches();
		initRoles();
		
		$("#createUserBtn").click(function() {
			$("#createUserBtn").prop("disabled", true);
			
			const username = $("#username").val();
			const email = $("#email").val();
			const pass=$("#pass").val();
			const cpass=$("#cpass").val();
			const status=$("#status").val();
			const branch=JSON.parse($("#branch").val());
			const role=JSON.parse($("#role").val());

			if (undefined == username || username == "") {
				$("#statusMsg").html("Enter valid User Name");
				$("#username").focus();
				$("#createUserBtn").prop("disabled", false);
				return;
			}
			if (undefined == email || email == "") {
				$("#statusMsg").html("Enter valid Email");
				$("#email").focus();
				$("#createUserBtn").prop("disabled", false);
				return;
			}
			if (undefined == pass || pass == "") {
				$("#statusMsg").html("Enter valid Password");
				$("#pass").focus();
				$("#createUserBtn").prop("disabled", false);
				return;
			}
			if (undefined == email || pass != cpass) {
				$("#statusMsg").html("Password and Confirm password not matching");
				$("#cpass").focus();
				$("#createUserBtn").prop("disabled", false);
				return;
			}
			if (undefined == status || status === "0") {
				$("#statusMsg").html("Select valid Status");
				$("#status").focus();
				$("#createUserBtn").prop("disabled", false);
				return;
			}
			if(undefined==JSON.stringify(branch.id)){
				$("#statusMsg").html("Select valid Branch");
				$("#branch").focus();
				$("#createUserBtn").prop("disabled", false);
				return;
			}
			if(undefined==JSON.stringify(role.id)){
				$("#statusMsg").html("Select valid Role");
				$("#role").focus();
				$("#createUserBtn").prop("disabled", false);
				return false;
			}
			$("#statusMsg").html("");
			const reqObj = {"userName" : username, "email" : email, "password" : pass,
					"status" : status, "branchId" : branch.id, "roleId" : role.id}

			$.post("/users", JSON.stringify(reqObj), function(res) {
					$("#omsToast").html(res.message);
					$('.toast').removeClass('bg-danger').addClass('bg-success').toast('show');
				}).fail(function(res) {
					$("#omsToast").html(JSON.parse(res.responseText).message);
					$('.toast').addClass('bg-danger').toast('show');
				});
			$("#createUserBtn").prop("disabled", false);
			});
		});
	function initBranches(){
		$("#branch").empty();
		$("#branch").append("<option value=0 selected>Select Branch</option>");
		$.get("/branches",function(res){
			res.forEach(branch =>{
				$("#branch").append("<option value="+JSON.stringify(branch)+">"+branch.branchName+"</option>");
			});
			
		})
	}
	function initRoles(){
		$("#role").empty();
		$("#role").append("<option value=0 selected>Select Role</option>");
		$.get("/roles",function(res){
			res.forEach(role =>{
				$("#role").append("<option value="+JSON.stringify(role)+">"+role.roleName+"</option>");
			});
			
		})
	}
</script>
</head>
<body>
	<div class="card m-3" style="min-height: 400px;">
		<div class="card-body">
			<div class="mb-1">
				<label for="username" class="mb-0">Username</label> <input
					class="form-control" id="username" placeholder="Username">
			</div>
			<div class="mb-1">
				<label for="email" class="mb-0">Email</label> <input
					class="form-control" id="email" placeholder="Email">
			</div>
			<div class="mb-1">
				<label for="pass" class="mb-0">Password</label> <input type="password"
					class="form-control" id="pass" placeholder="Password">
			</div>
			<div class="mb-1">
				<label for="cpass" class="mb-0">Confirm Password</label> <input type="password"
					class="form-control" id="cpass" placeholder="Confirm Password">
			</div>
			<div class="mb-1">
				<label for="status" class="mb-0">Status</label> <select id="status"
					class="form-select form-select-sm" aria-label="Select Status">
					<option value="0">Select status</option>
					<option value="Active">Active</option>
					<option value="Disabled">Disabled</option>
				</select>
			</div>
			<div class="mb-1">
				<label for="branch" class="mb-0">Branch</label> <select
					id="branch" class="form-select form-select-sm"
					aria-label="Select Branch">
				</select>
			</div>
			<div class="mb-1">
				<label for="role" class="mb-0">Role</label> <select
					id="role" class="form-select form-select-sm"
					aria-label="Select Role">
				</select>
			</div>
			<button type="button" id="createUserBtn"
				class="btn btn-primary mt-1">Create User</button>
		</div>
	</div>
</body>
</html>
