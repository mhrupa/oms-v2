<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<script type="text/javascript">
		$(document).ready(function () {
			initCustomerData();
			$("#customer").change(onCustomerChange);
			$("#deleteCustomerBtn").click(function () {
				//console.log($("#customers").val());
				$("#deleteCustomerBtn").prop("disabled", true);
				let selectedCustomerData = $("#customer").val();
				let selectedCustomerId = selectedCustomerData.split("[")[1].split("]")[0];
				
				if (undefined == selectedCustomerId || selectedCustomerId == 0) {
					$("#customer").focus();
					$("#deleteCustomerBtn").prop("disabled", false);
					return;
				}

				const reqObj = {}

				$.ajax({
					type: 'DELETE',
					url: "/customers/" + selectedCustomerId,
					contentType: 'application/json',
					data: JSON.stringify(reqObj),
				}).done(function (res) {
					initControlls();
					initCustomerData();
					$("#omsToast").html(res.message);
					$('.toast').removeClass('bg-danger').addClass('bg-success').toast('show');
				}).fail(function (res) {
					$("#omsToast").html(JSON.parse(res.responseText).message);
					$('.toast').addClass('bg-danger').toast('show');
				});
				$("#deleteCustomerBtn").prop("disabled", false);
			});
		});

		function onCustomerChange() {
			
			if ($("#customer").val() == "") {
                $("#customer").focus();
                return false;
            }
			
			let selectedCustomerData = $("#customer").val();
			let selectedCustomerId = selectedCustomerData.split("[")[1].split("]")[0];
			
			let tempCust = customerUpdateData[selectedCustomerId];
			$("#email").val(tempCust.email);
			$("#contact").val(tempCust.contact);
			$("#location").val(tempCust.location);
		}

		function initCustomerData() {
			$.get("/customers", function (res) {
				$("#customerData").empty();
				res.forEach(customer => {
					//console.log(JSON.stringify(customer));
					//console.log(customer.id);
					//console.log(customer.customerName);
					customerUpdateData[customer.id] = customer;
					 $("#customerData").append("<option value='" + customer.customerName 
					 + "(" + customer.location + "[" + customer.id + "])'></option>");
				});


			})
		}
		function initControlls() {
			$("#customer").val("");
			$("#email").val("");
			$("#contact").val("");
			$("#location").val("");
		}

	</script>
</head>

<body>
	<div class="card m-3" style="min-height: 200px;">
		<div class="card-body">
			<div class="d-flex flex-row">
				<!--<select id="customers" style="max-width: 200px;" class="form-select form-select-sm"
					aria-label="Select Customer">
				</select>-->

				<div class="input-group mb-0">
					<span class="input-group-text"
						style="width: 140px; text-align: right; display: block;">Customer</span>
					<input class="form-control" autocomplete="off" list="customerData" accesskey="b" id="customer"
						placeholder="Search Customer...">
					<datalist id="customerData">
					</datalist>
				</div>


				<label for="email" class="p-2 pb-0">Email</label>
				<input type="email" disabled class="form-control" id="email" style="max-width: 200px;"
					placeholder="Email">
				<label for="contact" class="p-2 pb-0">Contact</label> <input disabled class="form-control" id="contact"
					style="max-width: 150px;" placeholder="Contact">
				<label for="location" class="p-2 pb-0">Location</label>
				<input class="form-control" disabled id="location" placeholder="Location">
			</div>
			<button type="button" id="deleteCustomerBtn" class="btn btn-primary mt-1">Delete Customer</button>
		</div>
	</div>
</body>

</html>