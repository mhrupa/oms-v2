<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<script type="text/javascript">
	$(document).ready(function() {
		$("#statusMsg").html("");
		
		initCategorydata();
		
		$("#categoryCodeSelect").change(function(){
			const category=JSON.parse($(this).val());
			$("#categoryName").val(category.categoryName);
		})
		
		$("#updateCategoryBtn").click(function() {
			$("#updateCategoryBtn").prop("disabled", true);
			const category=JSON.parse($("#categoryCodeSelect").val());
			
			if(undefined==JSON.stringify(category.id)){
				$("#statusMsg").html("Select valid Category");
				$("#categoryCodeSelect").focus();
				$("#updateCategoryBtn").prop("disabled", false);
				return false;
			}
			
			const categoryNameVal = $("#categoryName").val();

			if (undefined == categoryNameVal || categoryNameVal == "") {
				$("#statusMsg").html("Enter valid Category Name");
				$("#categoryName").focus();
				$("#updateCategoryBtn").prop("disabled", false);
				return;
			}
			
			$("#statusMsg").html("");
			const reqObj = {"categoryName" : categoryNameVal, "categoryCode" : category.categoryCode}

			$.ajax({
			    type: 'PUT',
			    url: "/categories/"+category.id,
			    contentType: 'application/json',
			    data: JSON.stringify(reqObj), 
			}).done(function(res) {
				initCategorydata();
				$("#omsToast").html(res.message);
				$('.toast').removeClass('bg-danger').addClass('bg-success').toast('show');
			}).fail(function(res) {
				$("#omsToast").html(JSON.parse(res.responseText).message);
				$('.toast').addClass('bg-danger').toast('show');
			});
			$("#updateCategoryBtn").prop("disabled", false);
			});
		});
	function initCategorydata(){
		$("#categoryName").val("");
		$("#categoryCodeSelect").empty();
		$("#categoryCodeSelect").append("<option value=0 selected>Select Category</option>");
		$.get("/categories",function(res){
			res.forEach(category =>{
				$("#categoryCodeSelect").append("<option value="+JSON.stringify(category)+">"+category.categoryName+"</option>");
			});
			
		})
	}
</script>
</head>
<body>
	<div class="card m-3" style="min-height: 400px;">
		<div class="card-body">
			<div class="mb-1">
				<label for="categoryCodeSelect" class="mb-0">Category Code</label> <select
					id="categoryCodeSelect" class="form-select form-select-sm"
					aria-label="Select Category">
				</select>
			</div>
			<div class="mb-1">
				<label for="categoryName" class="mb-0">Category Name</label> <input
					class="form-control" id="categoryName" placeholder="Category Name">
			</div>
			<button type="button" id="updateCategoryBtn"
				class="btn btn-primary mt-1">Update Category</button>
		</div>
	</div>
</body>
</html>
